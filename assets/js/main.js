document.addEventListener('DOMContentLoaded',()=>{const profissaoSelect=document.getElementById('profissao');const postoGroup=document.getElementById('posto-group');const idadeInput=document.getElementById('idade');const capitalSelect=document.getElementById('capital');const coberturaIPA_check=document.getElementById('cobertura-ipa');const coberturaIFPD_check=document.getElementById('cobertura-ifpd');const coberturaFuneral_check=document.getElementById('cobertura-funeral');const valorMorteEl=document.getElementById('valor-morte');const valorIPAEl=document.getElementById('valor-ipa');const valorIFPDEl=document.getElementById('valor-ifpd');const premioTotalEl=document.getElementById('premio-total');const simuladorCard=document.getElementById('simulador-card');const contratacaoSection=document.getElementById('contratacao-section');const btnMostrarFormFinal=document.getElementById('btn-mostrar-form-final');const formFinalResumoInput=document.getElementById('form-final-resumo');const formatarMoeda=(valor)=>new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'}).format(valor);const buscarPreco=(tabela,idade,capital)=>{if(!tabela||!idade||!capital)return 0;let dadosIdade=tabela[idade];if(!dadosIdade){for(const faixa in tabela){if(faixa.includes('-')){const[min,max]=faixa.split('-').map(Number);if(idade>=min&&idade<=max){dadosIdade=tabela[faixa];break}}}}
if(!dadosIdade)return 0;const capitaisDisponiveis=Object.keys(dadosIdade).map(Number).sort((a,b)=>a-b);if(dadosIdade[capital]){return dadosIdade[capital]}
let menorCapital=capitaisDisponiveis[0];let maiorCapital=capitaisDisponiveis[capitaisDisponiveis.length-1];for(const c of capitaisDisponiveis){if(c<capital)menorCapital=c;if(c>capital){maiorCapital=c;break}}
if(menorCapital===maiorCapital)return dadosIdade[menorCapital];const precoMenor=dadosIdade[menorCapital];const precoMaior=dadosIdade[maiorCapital];const premio=precoMenor+((capital-menorCapital)/(maiorCapital-menorCapital))*(precoMaior-precoMenor);return isNaN(premio)?0:premio};const calcularEAtualizarTela=()=>{const idade=parseInt(idadeInput.value);const capitalBase=parseInt(capitalSelect.value);if(!idade||!capitalBase){premioTotalEl.textContent=formatarMoeda(0);return}
let premioTotal=0;let resumoParaForm="";const capitalFormatado=formatarMoeda(capitalBase);valorMorteEl.textContent=capitalFormatado;valorIPAEl.textContent=capitalFormatado;valorIFPDEl.textContent=capitalFormatado;const premioMorte=buscarPreco(TABELA_PRECOS.morte,idade,capitalBase);premioTotal+=premioMorte;resumoParaForm+=`Morte: ${capitalFormatado} (Prêmio: ${formatarMoeda(premioMorte)})\n`;if(coberturaIPA_check.checked){const premioIPA=buscarPreco(TABELA_PRECOS.ipa,idade,capitalBase);premioTotal+=premioIPA;resumoParaForm+=`Invalidez por Acidente: ${capitalFormatado} (Prêmio: ${formatarMoeda(premioIPA)})\n`}
if(coberturaIFPD_check.checked){const premioIFPD=buscarPreco(TABELA_PRECOS.ifpd,idade,capitalBase);premioTotal+=premioIFPD;resumoParaForm+=`Invalidez por Doença: ${capitalFormatado} (Prêmio: ${formatarMoeda(premioIFPD)})\n`}
if(coberturaFuneral_check.checked){const capitalFuneral=7000;const premioFuneral=buscarPreco(TABELA_PRECOS.funeral,idade,capitalFuneral);premioTotal+=premioFuneral;resumoParaForm+=`Assistência Funeral: ${formatarMoeda(capitalFuneral)} (Prêmio: ${formatarMoeda(premioFuneral)})\n`}
premioTotalEl.textContent=formatarMoeda(premioTotal);formFinalResumoInput.value=`--- SIMULAÇÃO ---\n${resumoParaForm}\n--- TOTAL MENSAL: ${formatarMoeda(premioTotal)} ---`};profissaoSelect.addEventListener('change',()=>{const profissoesMilitares=['Policial militar','Bombeiro militar','Militar Forças armadas'];postoGroup.classList.toggle('hidden',!profissoesMilitares.includes(profissaoSelect.value))});const inputsParaMonitorar=[idadeInput,capitalSelect,coberturaIPA_check,coberturaIFPD_check,coberturaFuneral_check,profissaoSelect];inputsParaMonitorar.forEach(elemento=>{elemento.addEventListener('input',calcularEAtualizarTela);elemento.addEventListener('change',calcularEAtualizarTela)});btnMostrarFormFinal.addEventListener('click',()=>{if(!idadeInput.value||!profissaoSelect.value){alert('Por favor, preencha sua profissão e idade para continuar.');return}
simuladorCard.classList.add('hidden');contratacaoSection.classList.remove('hidden');window.scrollTo({top:0,behavior:'smooth'})});calcularEAtualizarTela()})